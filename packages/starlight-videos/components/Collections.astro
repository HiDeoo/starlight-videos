---
import type { Props } from '@astrojs/starlight/props'

import { getEntryPath } from '../libs/path'
import { getCollections, getCollectionVideos } from '../libs/video'

import Card from './Card.astro'
import CardGrid from './CardGrid.astro'
import Duration from './Duration.astro'

const { locale } = Astro.props

const collections = await getCollections(locale)
---

<CardGrid>
  {
    collections.map(async (collection) => {
      const collectionVideos = await getCollectionVideos(collection.data.video, locale)
      const durations = collectionVideos.map((video) => video.data.video.duration)

      return (
        <Fragment>
          <Card
            description={collection.data.video.description ?? collection.data.description}
            link={getEntryPath(collection.id, locale)}
            title={collection.data.title}
          >
            <Duration value={durations} />
          </Card>
        </Fragment>
      )
    })
  }
</CardGrid>
